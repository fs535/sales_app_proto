<msg-box-template [message]="message"></msg-box-template>

<div class="product-container">
    <table class="table table-striped product-container-table">
        <thead class="{{isScroll ? 'offset-head' : ''}}">
        <tr>
            <th class="thtiny">
                <input placeholder="ID" title="Product ID" class="form-control" type="text"
                       (ngModelChange)="onProductIdSearch($event)" [(ngModel)]="productIdSearch"/>
            </th>
            <th class="thlargest">
                <input placeholder="Name" title="Product Name" class="form-control" type="text"
                       (ngModelChange)="onProductNameSearch($event)" [(ngModel)]="productNameSearch"/>
            </th>
            <th class="thsmall">
                <ng-select class="wide" [allowClear]="true"
                           [items]="category1values"
                           (selected)="onProductCategory1Search($event)"
                           (removed)="onProductCategory1Search({'id':'','text':''})"
                           placeholder="Category1" title="Category1">
                </ng-select>
            </th>
            <th class="thsmall">
                <ng-select class="wide" [allowClear]="true"
                           [items]="category2values"
                           (selected)="onProductCategory2Search($event)"
                           (removed)="onProductCategory2Search({'id':'','text':''})"
                           placeholder="Category2" title="Category2">
                </ng-select>
            </th>
            <th class="thsmall">
                <ng-select class="wide" [allowClear]="true"
                           [items]="category3values"
                           (selected)="onProductCategory3Search($event)"
                           (removed)="onProductCategory3Search({'id':'','text':''})"
                           placeholder="Category3" title="Category3">
                </ng-select>
            </th>
            <th class="thtiny">
                <ng-select class="wide" [allowClear]="true"
                           [items]="prices"
                           (selected)="onProductPriceSearch($event)"
                           (removed)="onProductPriceSearch({'id':'','text':''})"
                           placeholder="PR" title="Price">
                </ng-select>
            </th>
            <th class="thtiny">
                <ng-select class="wide" [allowClear]="true"
                           [items]="brands"
                           (selected)="onProductBrandSearch($event)"
                           (removed)="onProductBrandSearch({'id':'','text':''})"
                           placeholder="BR" title="Brand">
                </ng-select>
            </th>
            <th class="thtiny">
                <ng-select class="wide" [allowClear]="true"
                           [items]="sizes"
                           (selected)="onProductSizeSearch($event)"
                           (removed)="onProductSizeSearch({'id':'','text':''})"
                           placeholder="SZ" title="Size">
                </ng-select>
            </th>
            <th class="thtiny">
                <ng-select class="wide" [allowClear]="true"
                           [items]="discounts"
                           (selected)="onOfferDiscountSearch($event)"
                           (removed)="onOfferDiscountSearch({'id':'','text':''})"
                           placeholder="DISC" title="Discount">
                </ng-select>
            </th>
            <th class="thtiny">
                <input placeholder="OID" title="Offer ID" class="form-control" type="text"
                       (ngModelChange)="onOfferIdSearch($event)" [(ngModel)]="offerIdSearch"/>
            </th>
            <th class="thlarge">
                <input placeholder="Offer Name" title="Offer Name" class="form-control" type="text"
                       (ngModelChange)="onOfferNameSearch($event)" [(ngModel)]="offerNameSearch"/>
            </th>
            <th class="thtiny">
                <ng-select class="wide" [allowClear]="true"
                           [items]="yesno"
                           (selected)="onProductActivatedPimSearch($event)"
                           (removed)="onProductActivatedPimSearch({'id':'','text':''})"
                           placeholder="PIM" title="Activated PIM?">
                </ng-select>
            </th>
            <th class="thsmall">
                <input placeholder="Valid From" title="Valid from date" class="form-control" type="text"
                       (ngModelChange)="onOfferValidFromSearch($event)"
                       [(ngModel)]="offerValidFromSearch"/>
            </th>
            <th class="thsmall">
                <input placeholder="Valid To" title="Valid to date" class="form-control" type="text"
                       (ngModelChange)="onOfferValidToSearch($event)"
                       [(ngModel)]="offerValidToSearch"/>
            </th>
            <th class="thtiny">
                <ng-select class="wide" [allowClear]="true"
                           [items]="yesno"
                           (selected)="onOfferActiveSearch($event)"
                           (removed)="onOfferActiveSearch({'id':'','text':''})"
                           placeholder="ACT" title="Active offer?">
                </ng-select>
            </th>
        </tr>
        </thead>
        <tbody infinite-scroll
               [infiniteScrollDistance]="5"
               [infiniteScrollUpDistance]="1"
               [infiniteScrollThrottle]="50"
               [scrollWindow]="false"
               (scrolled)="onScrollDown()"
               (scrolledUp)="onScrollUp()">

        <tr *ngFor="let product of products" (mousedown)="onProductSelect(product);true" [class.unassigned]="!product.offerId" [class.selected]="product.id === selectedProduct.id">

        <!--<tr *ngFor="let product of products | paginate: { id: 'productsPagination', itemsPerPage: pageSize, currentPage: productsCurrentPage, totalItems: productsTotalItems }" (mousedown)="onProductSelect(product);true"
            [class.unassigned]="!product.offerId" [class.selected]="product.id === selectedProduct.id">-->
            <td class="tdtiny">
                <input readonly="true" [class.unassigned]="!product.offerId" [class.selected]="product.id === selectedProduct.id" class="wide"
                       type="text"
                       [ngModel]="product.product"/>
            </td>
            <td class="tdlargest">
                <input readonly="true" [class.unassigned]="!product.offerId" [class.selected]="product.id === selectedProduct.id" class="wide"
                       type="text"
                       [ngModel]="product.productName"/>
            </td>
            <td class="tdsmall">
                <input readonly="true" [class.unassigned]="!product.offerId" [class.selected]="product.id === selectedProduct.id" class="wide"
                       type="text"
                       [ngModel]="product.productCategory1Name"/>
            </td>
            <td class="tdsmall">
                <input readonly="true" [class.unassigned]="!product.offerId" [class.selected]="product.id === selectedProduct.id" class="wide"
                       type="text"
                       [ngModel]="product.productCategory2Name"/>
            </td>
            <td class="tdsmall">
                <input readonly="true" [class.unassigned]="!product.offerId" [class.selected]="product.id === selectedProduct.id" class="wide"
                       type="text"
                       [ngModel]="product.productCategory3Name"/>
            </td>
            <td class="tdtiny">
                <input readonly="true" [class.unassigned]="!product.offerId" [class.selected]="product.id === selectedProduct.id" class="wide"
                       type="text"
                       [ngModel]="product.ecomPrice"/>
            </td>
            <td class="tdtiny">
                <input readonly="true" [class.unassigned]="!product.offerId" [class.selected]="product.id === selectedProduct.id" class="wide"
                       type="text"
                       [ngModel]="product.brand"/>
            </td>
            <td class="tdtiny">
                <input readonly="true" [class.unassigned]="!product.offerId" [class.selected]="product.id === selectedProduct.id" class="wide"
                       type="text"
                       [ngModel]="product.packageSize"/>
            </td>
            <td class="tdtiny">
                <input *ngIf="product.offer != null" [class.selected]="product.id === selectedProduct.id" class="wide"  (focus)="focusOnOffer('discount', product.offer)" (blur)="checkAndSaveOffer('discount', product.offer)"
                       type="text"
                       [(ngModel)]="product.offer.discount"/>
            </td>
            <td class="tdtiny">
                <input [class.unassigned]="!product.offerId" [class.selected]="product.id === selectedProduct.id" class="wide" (focus)="focusOnProduct('offerId', product)" (blur)="checkAndSaveProduct('offerId', product)"
                       type="text"
                       [(ngModel)]="product.offerId"/>
            </td>
            <td class="tdlarge">
                <input *ngIf="product.offer != null" [class.selected]="product.id === selectedProduct.id" class="wide" (focus)="focusOnOffer('name', product.offer)" (blur)="checkAndSaveOffer('name', product.offer)"
                       type="text"
                       [(ngModel)]="product.offer.name"/>
            </td>
            <td class="tdtiny">
                <input class="wide" [class.unassigned]="!product.offerId" [class.selected]="product.id === selectedProduct.id" type="text" *ngIf="product.activatedPim" readonly="true" value="Yes" />
                <input class="wide" [class.unassigned]="!product.offerId" [class.selected]="product.id === selectedProduct.id" type="text" *ngIf="!product.activatedPim" readonly="true" value="No" />
            </td>
            <td class="tdsmall">
                <input *ngIf="product.offer != null" class="wide" [class.selected]="product.id === selectedProduct.id"
                       type="text"
                       placeholder="yyyy-mm-dd"
                       [class.invalid]="invalidOfferMap[product.offer.id]?.validFrom" title="{{invalidOfferMap[product.offer.id]?.validFrom}}"
                       [ngModel]="formatDate(product.offer.validFrom)" (change)="onOfferChangeValidFrom(product.offer, $event.target.value, false)" />
            </td>
            <td class="tdsmall">
                <input *ngIf="product.offer != null" class="wide" [class.selected]="product.id === selectedProduct.id"
                       type="text"
                       placeholder="yyyy-mm-dd"
                       [class.invalid]="invalidOfferMap[product.offer.id]?.validTo" title="{{invalidOfferMap[product.offer.id]?.validTo}}"
                       [ngModel]="formatDate(product.offer.validTo)" (change)="onOfferChangeValidTo(product.offer, $event.target.value, false)" />
            </td>
            <td class="tdtiny">
                <md-slide-toggle *ngIf="product.offer != null" [class.selected]="product.id === selectedProduct.id" [(ngModel)]="product.offer.active"
                                 (change)="onOfferActiveChange($event, product.offer)"></md-slide-toggle>
            </td>
        </tr>
        </tbody>
    </table>

    <!--<div class="pagination-block">
        <pagination-controls id="productsPagination" directionLinks="true" (pageChange)="productsPageChanged($event)"></pagination-controls>
    </div>-->

</div>
<div class="details-container">
    <table class="table table-striped details-container-table">
        <thead>
        <tr>
            <th class="thlarge">
                Description
            </th>
            <th class="thtiny" title="Demand ID">
                DID
            </th>
            <th class="thtiny" title="Demand Count">
                DCNT
            </th>
            <th class="thtiny" title="Benefit ID">
                BID
            </th>
            <th class="thtiny" title="Comb Max">
                CMAX
            </th>
            <th class="thtiny" title="Comb Type">
                CT
            </th>
            <th class="thtiny" title="Comb Card Prefix">
                CCP
            </th>
            <th class="thtiny" title="Comb Stacking">
                CS
            </th>
            <th class="thsmall" title="Comb External ID">
                CExtID
            </th>
            <th class="thlarge">
                Picture URL
            </th>
        </tr>
        </thead>
        <tbody *ngIf="selectedProduct.id != ''">
        <tr [class.unassigned]="!selectedProduct.offerId" [class.selected]="true">
            <td class="tdlarge">
                <input readonly="true" [class.unassigned]="!selectedProduct.offerId" [class.selected]="true" class="wide"
                       type="text"
                       [ngModel]="selectedProduct.description"/>
            </td>
            <td class="tdtiny">
                <input readonly="true" *ngIf="selectedProduct.offer != null" [class.unassigned]="!selectedProduct.offerId" [class.selected]="true" class="wide"
                       type="text"
                       [ngModel]="selectedProduct.offer.demandId"/>
            </td>
            <td class="tdtiny">
                <input readonly="true" *ngIf="selectedProduct.offer != null" [class.unassigned]="!selectedProduct.offerId" [class.selected]="true" class="wide"
                       type="text"
                       [ngModel]="selectedProduct.offer.demandCount"/>
            </td>
            <td class="tdtiny">
                <input readonly="true" *ngIf="selectedProduct.offer != null" [class.unassigned]="!selectedProduct.offerId" [class.selected]="true" class="wide"
                       type="text"
                       [ngModel]="selectedProduct.offer.benefitId"/>
            </td>
            <td class="tdtiny">
                <input readonly="true" *ngIf="selectedProduct.offer != null" [class.unassigned]="!selectedProduct.offerId" [class.selected]="true" class="wide"
                       type="text"
                       [ngModel]="selectedProduct.offer.combMax"/>
            </td>
            <td class="tdtiny">
                <input readonly="true" *ngIf="selectedProduct.offer != null" [class.unassigned]="!selectedProduct.offerId" [class.selected]="true" class="wide"
                       type="text"
                       [ngModel]="selectedProduct.offer.combType"/>
            </td>
            <td class="tdtiny">
                <input readonly="true" *ngIf="selectedProduct.offer != null" [class.unassigned]="!selectedProduct.offerId" [class.selected]="true" class="wide"
                       type="text"
                       [ngModel]="selectedProduct.offer.combCardPrefix"/>
            </td>
            <td class="tdtiny">
                <input readonly="true" *ngIf="selectedProduct.offer != null" [class.unassigned]="!selectedProduct.offerId" [class.selected]="true" class="wide"
                       type="text"
                       [ngModel]="selectedProduct.offer.combStacking"/>
            </td>
            <td class="tdsmall">
                <input readonly="true" *ngIf="selectedProduct.offer != null" [class.unassigned]="!selectedProduct.offerId" [class.selected]="true" class="wide"
                       type="text"
                       [ngModel]="selectedProduct.offer.combExternalId"/>
            </td>
            <td class="tdlarge">
                <input readonly="true" [class.unassigned]="!selectedProduct.offerId" [class.selected]="true" class="wide"
                       type="text"
                       [ngModel]="selectedProduct.pimPicture"/>
            </td>
        </tr>
        </tbody>
    </table>
</div>